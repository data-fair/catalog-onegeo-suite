{
  "$id": "https://github.com/data-fair/catalog-onegeo-suite/import-config",
  "x-exports": [
    "schema"
  ],
  "title": "ImportConfig",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "service",
    "format"
  ],
  "properties": {
    "service": {
      "type": "string",
      "title": "Web Service",
      "x-i18n-title": {
        "fr": "Service Web"
      },
      "description": "This resource is available from multiple sources (web services, local files). Select the source you want to use for the import.",
      "x-i18n-description": {
        "fr": "Cette ressource est disponible via plusieurs sources (services web, fichiers locaux). Sélectionnez la source que vous souhaitez utiliser pour l'import."
      },
      "layout": {
        "cols": 6,
        "getItems": {
          "url": "${context.catalogConfig}/fr/indexer/elastic/_search/?q=_id:${context.resourceId}",
          "itemsResults": "(function() { const links = data.hits.hits[0]._source['metadata-fr'].link; return links.filter(l => l.formats.find(f => ['CSV', 'ODS', 'Excel non structuré', 'Microsoft Excel','ZIP', 'Shapefile (zip)', 'GeoJSON', 'JSON', 'XML', 'GML', 'KML'].includes(f)) || ['WS', 'AFS', 'WFS'].includes(l.service)).map((l, i) =>  [l, i] );  })()",
          "itemTitle": "item[0].service?? 'Local N°' + (item[1] + 1)",
          "itemValue": "item[0].service??  item[0].url"
        }
      }
    },
    "format": {
      "type": "string",
      "title": "Format",
      "layout": {
        "if": "parent.data.service != null",
        "cols": 6,
        "getItems": {
          "url": "${context.catalogConfig}/fr/indexer/elastic/_search/?q=${parent.data.service}&q=_id:${context.resourceId}",
          "itemsResults": "(function(){const service = data.hits.hits[0]._source['metadata-fr'].link.find(x => x.service === parent.data.service || x.url === parent.data.service); let formats = service.formats; if (['WS', 'WFS', 'AFS'].includes(service.service) && !formats.includes('CSV')) {formats.push('CSV');} return formats; })()"
        }
      }
    }
  },
  "layout": {
    "title": null
  }
}