{
  "$id": "https://github.com/data-fair/catalog-onegeo-suite/import-config",
  "x-exports": [
    "schema"
  ],
  "title": "ImportConfig",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "service",
    "format"
  ],
  "properties": {
    "service": {
      "type": "string",
      "title": "Web Service",
      "description": "The source of the resource",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "image_url": {
          "type": "string"
        }
      },
      "layout": {
        "getItems": {
          "url": "${context.catalogConfig.url}/fr/indexer/elastic/_search/?q=_id:${context.resourceId}",
          "itemsResults": "(function() { const links = data.hits.hits[0]._source['metadata-fr'].link; return links.filter(l => l.formats.find(f => ['CSV', 'ODS', 'Excel non structuré', 'Microsoft Excel','ZIP', 'Shapefile (zip)', 'GeoJSON', 'JSON', 'XML', 'GML', 'KML'].includes(f)) || ['WS', 'AFS', 'WFS'].includes(l.service)).map((l, i) =>  [l, i] );  })()",
          "itemTitle": "item[0].service?? 'Local N°' + (item[1] + 1)",
          "itemValue": "item[0].service??  item[0].url"
        }
      }
    },
    "format": {
      "type": "string",
      "title": "Format",
      "description": "the fomat use",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "image_url": {
          "type": "string"
        }
      },
      "layout": {
        "getItems": {
          "url": "${context.catalogConfig.url}/fr/indexer/elastic/_search/?q=_id:${context.resourceId}",
          "itemsResults": "(function(){return data.hits.hits[0]._source['metadata-fr'].link.find(x => x.service === parent.data.service || x.url === parent.data.service).formats; })()",
          "itemTitle": "item",
          "itemValue": "item"
        }
      }
    }
  },
  "layout": [
    {
      "children": [
        "service"
      ]
    },
    {
      "if": "parent.data.service != null",
      "children": [
        "format"
      ]
    }
  ]
}